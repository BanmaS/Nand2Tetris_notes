# Module5:计算机体系结构
## Hack硬件平台
这一单元主要是把之前写过的芯片组合起来，结合上一单元中汇编语言指令的知识，搭建一个简易的Hack计算机，其中需要自己实现的芯片为处理器CPU、内存Memory，并最终拼接起来形成完整的Computer。

其中，主要的难点在于CPU的实现，需要对Module4中涉及的A/C指令有比较巩固的认识。CPU的结构其实书上已经给出来了，只需要自己给出各个控制单元的逻辑，按照书上的结构连起来。其中重点是A/C指令的判断，是否存入A/D寄存器，是否写入M，ALU计算的输入是什么，是否jump等
## 项目：Memory实现
Memory的实现总体来讲还是比较简单的，看着书上的图来就可以。根据```Memory.hdl```文件前面的注释提示，地址address<0x4000的为RAM16K的部分，地址为0x4000-0x5FFF的为Screen的部分，地址为0x6000的为Keyboard的部分。

所以可以通过输入地址的第14和13位，即address[14]和address[13]来判断：
* 如果address[14]=0，那么一定为RAM输出
* 如果address[14]=1，且address[13]=0，一定为Screen输出
* 如果address[14]=1，且address[13]=1，一定为keyboard输出

搞清楚这个之后后面就比较容易了，把对应的控制地址和判断完的load输入到RAM、screen中，最后通过两个Mux16进行输出的判断就可以了
## 项目：CPU实现
这一部分的实现思路在```CPU.hdl```中的注释里已经写的比较清楚了，其实主要按照参考书P94的结构来写就可以，这里主要是简单梳理一下。
* 首先判断通过ins的最高位是A指令还是C指令，然后选择要存的数据是指令的值（A指令）还是ALU的输出（C指令，计算结果）
* 结合A/C指令和d位域的值判断是否要存进A/D寄存器和写入M（writeM的值）
* 把c位域的值和ALU的输入按顺序一一对应输入ALU
* 结合ALU的输出和j位域判断跳转，输入PC
## 项目：Computer实现
写完了CPU和Memory这部分就很简单了，按书上P97的图连起来就可以了（ROM32K不需要自己写）

感觉在写CPU的时候也可以边看看P97的Computer的结构图，容易理解outM，inM，addressM的关系，写CPU的时候脑袋会比较清醒，个人感觉比较容易模糊的点是A指令的情况下writeM=0，并不会通过outM对内存M进行写入，但是会通过address寻找内存中对应的值，将其作为下一条C指令的inM
