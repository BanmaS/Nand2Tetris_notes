# Module4:Machine Language 机器语言
## 机器语言
机器语言，也即是汇编语言，在嵌入式中曾经接触过，本单元中使用的Hack机器语言Hack是基于冯诺依曼架构的16位计算机，
由一个CPU、两个内存（指令内存（ROM）和数据内存（RAM））和两个内存映射IO设备（显示器和键盘）组成。
## Hack语言规范
这部分中文书由于翻译的原因读起来可能比较绕，需要仔细多读几遍，总体来讲就是需要理解Hack的两个16位寄存器D和A
和隐式内存地址M的作用：
* D：仅可用来存数据，可以理解为数据的暂存器
* A：主要用来存地址，也可以存数据，同时隐式地制定了jump操作的跳转地址，这部分具体可以看书
* M：隐式内存地址，代表一个内存单元中的数值，**该内存单元中的地址就是A寄存器中的数值**

同时，Hack语言中包含了两种指令，分别是A指令和C指令，A指令用来为A寄存器赋值，
主要是设置操作地址，C指令执行实际的操作。

理解了D/A/M和A/C指令的作用，结合之前学过一部分汇编语言的基础，理解Hack语言比较容易了。
具体的细节语法书上讲的比较详细，可以按需求仔细看。
## 项目1：乘法器
乘法器要求计算R0×R1的值，结果存储在R2中，实现的思路是把R1本身当做循环变量，R0×R1可以简单地看做R1个R0
相加，所以只需要先把输出地址R2置零，然后构建一个循环，在每个循环内依次执行以下操作：
* 判断R1是否已经为0，如果是则循环结束，GOTO END
* 将R0的值加到R2中
* 对R1自减，然后GOTO LOOP回到循环起点
## 项目2：I/O处理程序
I/O处理程序要求在按下键盘任意键时，把屏幕慢慢涂黑，当松开键盘时，把涂黑的地方慢慢恢复变白。
用到的额外的基础的知识主要是Hack平台与键盘/屏幕的交互，在4.2.5节有详细介绍。这一部分的代码注释我写的比较
详细，这里主要简单讲一下思路。

首先定义一些参数，把屏幕的最大地址24576-1=24575存到内存R0中，把屏幕的当前地址（初始值为SCREEN）存到内存
R1中。

然后定义初始读取键盘的循环LOOP，这里主要有两种情形：
* 键盘被按下，即键盘读到的值大于0，则进入涂黑屏幕的循环BLACKLOOP
* 反之，键盘没被按下，进入清空屏幕的循环WHITELOOP

对涂黑屏幕的循环，执行下面的步骤
* 首先根据R0和R1中值的大小判断屏幕是否涂满了，如果涂满了（屏幕此时全黑）就回到初始循环LOOP
* 屏幕没满，那么需要涂黑一个地址的屏幕，首先把R1中的当前地址赋给D和A，赋给D是为了计算下个地址，赋给
A是为了涂黑当前地址
* 使M=-1，其实是M[A]=1111111111111111,就是把A（当前地址）的屏幕变为全黑
* 把D中当前地址的值加一后赋给R1，生成新的地址（即下一个BLACKLOOP/WHITELOOP的当前地址）
* 回到循环LOOP

对涂白屏幕的循环，思路和涂黑的相同，只是刚开始判断时判断屏幕是否为空，
然后把变黑变成变白，更新地址时加一变成减一就可以了，剩下的一样















